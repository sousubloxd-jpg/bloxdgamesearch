<script>
    async function updateLeaderboard() {
        const apiUrl = "https://social28.bloxd.io";
        // Using AllOrigins proxy to bypass the 403 Forbidden error
        const proxyUrl = `https://api.allorigins.win{encodeURIComponent(apiUrl)}`;

        try {
            const response = await fetch(proxyUrl);
            const wrapper = await response.json();
            
            // AllOrigins wraps the data in a "contents" string, so we must parse it
            const data = JSON.parse(wrapper.contents);

            // Sort by CCU (High to Low) and take top 10
            const top10 = data.sort((a, b) => b.ccu - a.ccu).slice(0, 10);

            let tableHtml = `<table>
                <tr>
                    <th>Rank</th>
                    <th>Game Name</th>
                    <th>Live Players (CCU)</th>
                    <th>Total Favorites</th>
                </tr>`;

            top10.forEach((game, index) => {
                tableHtml += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${game.name}</td>
                        <td class="ccu-count">${game.ccu.toLocaleString()}</td>
                        <td class="fav-count">â˜… ${game.totalFavorites.toLocaleString()}</td>
                    </tr>`;
            });

            tableHtml += `</table>`;
            document.getElementById('leaderboard').innerHTML = tableHtml;
            
        } catch (err) {
            document.getElementById('leaderboard').innerHTML = "Proxy Error. Try refreshing in a moment.";
            console.error("Fetch error:", err);
        }
    }

    updateLeaderboard();
    setInterval(updateLeaderboard, 60000); 
</script>
